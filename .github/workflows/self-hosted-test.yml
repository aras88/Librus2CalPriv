name: Test Librus - Self Hosted

on:
  workflow_dispatch:
  schedule:
    - cron: '0 * * * *'  # Co godzinę

jobs:
  sync-librus:
    # ZMIANA: używamy self-hosted zamiast ubuntu-latest
    runs-on: self-hosted

    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v4

      - name: 🐍 Ensure Python
        run: |
          python3 --version || python --version

      - name: 📦 Install dependencies
        run: |
          pip3 install requests || pip install requests

      - name: 🧪 Run Librus Sync
        env:
          LIBRUS_USERNAME: ${{ secrets.LIBRUS_USERNAME }}
          LIBRUS_PASSWORD: ${{ secrets.LIBRUS_PASSWORD }}
        run: |
          python3 test_like_postman.py || python test_like_postman.py

      - name: ✅ Success
        run: |
          echo "Synchronizacja zakończona pomyślnie!"
          echo "Ten workflow działa na Twoim komputerze,"
          echo "więc Librus nie blokuje połączenia."